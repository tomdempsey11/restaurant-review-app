<%- include('../../partials/header', { title: 'Admin â€¢ Restaurants' }) %>

<section class="container page-section">
  <% const _q = (typeof q !== 'undefined' && q) ? q : ''; %>
  <% const _page = (typeof page !== 'undefined' && page) ? Number(page) : 1; %>
  <% const _totalPages = (typeof totalPages !== 'undefined' && totalPages) ? Number(totalPages) : 1; %>
  <% const _restaurants = Array.isArray(restaurants) ? restaurants : []; %>

  <div class="row-between mb-4">
    <h2 class="m-0">Admin: Restaurants</h2>

    <div class="admin-bar">
      <form class="admin-bar__search" method="GET" action="/admin/restaurants">
        <input class="input" type="text" name="q" value="<%= _q %>" placeholder="Search name, cuisine, address">
        <button class="btn btn--primary" type="submit">Search</button>
        <% if (_q) { %>
          <a class="btn btn--ghost" href="/admin/restaurants">Clear</a>
        <% } %>
      </form>

      <a class="btn btn--primary" href="/admin/restaurants/new">+ New Restaurant</a>
    </div>
  </div>


  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Cuisine</th>
          <th>Address</th>
          <th class="text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (_restaurants.length) { %>
          <% _restaurants.forEach(r => { %>
            <tr>
              <td><%= r.name %></td>
              <td><%= r.cuisine || '-' %></td>
              <td><%= r.address || '-' %></td>
              <td class="text-right nowrap">
                <div class="btn-group">
                  <a class="btn btn--ghost btn--sm" href="/restaurants/<%= r.slug %>" target="_blank" rel="noopener">View</a>
                  <a class="btn btn--primary btn--sm" href="/admin/restaurants/<%= r._id %>/edit">Edit</a>
                  <form class="inline-form" action="/admin/restaurants/<%= r._id %>/delete" method="POST" onsubmit="return confirm('Delete this restaurant?');">
                    <button class="btn btn--danger btn--sm" type="submit">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="4" class="text-muted">No restaurants yet.</td></tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <% if (_totalPages > 1) { %>
    <nav class="pager pager--center mt-4">
      <% for (let i = 1; i <= _totalPages; i++) { %>
        <a href="/admin/restaurants?<%= _q ? ('q=' + encodeURIComponent(_q) + '&') : '' %>page=<%= i %>"
           class="page-link <%= (i === _page) ? 'is-active' : '' %>"><%= i %></a>
      <% } %>
    </nav>
  <% } %>
</section>

<%- include('../../partials/footer') %>
