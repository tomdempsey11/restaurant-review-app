<%- include('../partials/header', { title: 'Contact Messages' }) %>

<section class="container container--narrow page-section">
  <h1 class="m-0 mb-4">Contact Messages</h1>

  <form method="GET" action="/admin/contact-messages" class="row align-center mb-2">
    <input class="input flex-1" type="text" name="q" value="<%= q || '' %>" placeholder="Search name, email, subject, message">
    <button class="btn btn--primary" type="submit">Search</button>
    <% if (q) { %><a class="btn btn--ghost" href="/admin/contact-messages">Clear</a><% } %>
  </form>

  <p class="muted mb-4"><%= total %> message<%= total === 1 ? '' : 's' %></p>

  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Name</th>
          <th>Email</th>
          <th>Subject</th>
          <th>Message</th>
        </tr>
      </thead>
      <tbody>
        <% if (!messages.length) { %>
          <tr>
            <td class="text-muted" colspan="5">No messages found.</td>
          </tr>
        <% } %>
        <% messages.forEach(m => { %>
          <tr>
            <td><%= new Date(m.createdAt).toLocaleString() %></td>
            <td><%= m.name %></td>
            <td><a href="mailto:<%= m.email %>"><%= m.email %></a></td>
            <td><%= m.subject %></td>
            <td class="prewrap"><%= m.message %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <% if (totalPages > 1) { %>
    <nav class="pager pager--center mt-4">
      <% for (let i = 1; i <= totalPages; i++) { %>
        <a
          href="/admin/contact-messages?<%= q ? ('q=' + encodeURIComponent(q) + '&') : '' %>page=<%= i %>"
          class="page-link <%= (i === page) ? 'is-active' : '' %>">
          <%= i %>
        </a>
      <% } %>
    </nav>
  <% } %>
</section>

<%- include('../partials/footer') %>
